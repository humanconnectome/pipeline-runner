---
structural:
  - function: check_required_variables
  - function: split_subject
  - function: choose_node
  - export:
      filename: $WORKING_DIR/$SUBJECT.ENVIRONMENT.sh
      output_var: ENV_SCRIPT
  - template:
      path: structural/get_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_GET_DATA_job.sh
      output_var: GET_DATA_SCRIPT
  - template:
      path: generic/process_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.PROCESS_DATA_job.sh
      output_var: PROCESS_DATA_SCRIPT
  - template:
      path: generic/clean_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.CLEAN_DATA_job.sh
      output_var: CLEAN_DATA_SCRIPT
  - template:
      path: generic/put_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_PUT_DATA_job.sh
      output_var: PUT_DATA_SCRIPT
  - template:
      path: generic/check_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_CHECK_DATA_job.sh
      output_var: CHECK_DATA_SCRIPT
  - function: chain_jobs_on_pbs

functional:
  - function: check_required_variables
  - function: split_subject
  - function: choose_node
  - export:
      filename: $WORKING_DIR/$SUBJECT.ENVIRONMENT.sh
      output_var: ENV_SCRIPT
  - template:
      input: functional/get_data.jinja2
      output: $WORKING_DIR/$SUBJECT.XNAT_GET_DATA_job.sh
      output_var: GET_DATA_SCRIPT
  - template:
      path: generic/process_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.PROCESS_DATA_job.sh
      output_var: PROCESS_DATA_SCRIPT
  - template:
      path: functional/clean_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.CLEAN_DATA_job.sh
      output_var: CLEAN_DATA_SCRIPT
  - template:
      path: generic/put_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_PUT_DATA_job.sh
      output_var: PUT_DATA_SCRIPT
  - template:
      path: generic/check_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_CHECK_DATA_job.sh
      output_var: CHECK_DATA_SCRIPT
  - function: chain_jobs_on_pbs

msmall:
  - function: check_required_variables
  - function: split_subject
  - function: choose_node
  - export:
      filename: $WORKING_DIR/$SUBJECT.ENVIRONMENT.sh
      output_var: ENV_SCRIPT
  - template:
      input: msmall/get_data.jinja2
      output: $WORKING_DIR/$SUBJECT.XNAT_GET_DATA_job.sh
      output_var: GET_DATA_SCRIPT
  - template:
      path: msmall/process_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.PROCESS_DATA_job.sh
      output_var: PROCESS_DATA_SCRIPT
  - template:
      path: msmall/clean_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.CLEAN_DATA_job.sh
      output_var: CLEAN_DATA_SCRIPT
  - template:
      path: generic/put_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_PUT_DATA_job.sh
      output_var: PUT_DATA_SCRIPT
  - template:
      path: generic/check_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_CHECK_DATA_job.sh
      output_var: CHECK_DATA_SCRIPT
  - function: chain_jobs_on_pbs

multirunicafix:
  - function: check_required_variables
  - function: split_subject
  - function: choose_node
  - export:
      filename: $WORKING_DIR/$SUBJECT.ENVIRONMENT.sh
      output_var: ENV_SCRIPT
  - template:
      path: generic/get_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_GET_DATA_job.sh
      output_var: GET_DATA_SCRIPT
  - template:
      path: multirunicafix/process_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.PROCESS_DATA_job.sh
      output_var: PROCESS_DATA_SCRIPT
  - template:
      path: multirunicafix/clean_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.CLEAN_DATA_job.sh
      output_var: CLEAN_DATA_SCRIPT
  - template:
      path: generic/put_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_PUT_DATA_job.sh
      output_var: PUT_DATA_SCRIPT
  - template:
      path: generic/check_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_CHECK_DATA_job.sh
      output_var: CHECK_DATA_SCRIPT
  - function: chain_jobs_on_pbs

diffusion:
  - function: check_required_variables
  - function: split_subject
  - function: choose_node
  - export:
      filename: $WORKING_DIR/$SUBJECT.ENVIRONMENT.sh
      output_var: ENV_SCRIPT
  - template:
      path: diffusion/get_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_GET_DATA_job.sh
      output_var: GET_DATA_SCRIPT
  - template:
      path: generic/process_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.PROCESS_DATA_job.sh
      output_var: PROCESS_DATA_SCRIPT
  - template:
      path: diffusion/clean_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.CLEAN_DATA_job.sh
      output_var: CLEAN_DATA_SCRIPT
  - template:
      path: generic/put_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_PUT_DATA_job.sh
      output_var: PUT_DATA_SCRIPT
  - template:
      path: generic/check_data.jinja2
      filename: $WORKING_DIR/$SUBJECT.XNAT_CHECK_DATA_job.sh
      output_var: CHECK_DATA_SCRIPT
  - function: chain_jobs_on_pbs

